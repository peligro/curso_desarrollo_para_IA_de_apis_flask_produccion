{% extends 'layouts/frontend.html' %} 

{% block title %} RAG (Retrieval Augmented Generation) {% endblock %}

{% block content %}
<div class="row">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#"><i class="fas fa-home"></i></a></li>
            <li class="breadcrumb-item"><a href="{{url_for('rag.rag_index')}}">RAG (Retrieval Augmented Generation)</a></li>
            <li class="breadcrumb-item active" aria-current="page">Ejercicio 1: RAG con PDF - Chatbot de Atención al Cliente</li>
        </ol>
    </nav>
</div>

<div class="row">
    <div class="col-12">
        {% include('componentes/flash.html') %}
        <h1>RAG (Retrieval Augmented Generation)</h1>
        <h4>Ejercicio 1: RAG con PDF - Chatbot de Atención al Cliente</h4>
        <hr/>
        <a href="{{ url_for('rag.rag_chatbot_atencion_cliente') }}" class="btn btn-warning btn-sm">

             <i class="fas fa-trash"></i> Limpiar Historial
        </a>
        <hr/>
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> 
            Este chatbot busca respuestas en el manual de atención al cliente usando la AI.
        </div>
        
        <form action="{{ url_for('rag.rag_chatbot_atencion_cliente') }}" method="post">
            <div class="form-group">
                <label for="idioma">Escoje la IA</label>
                <select name="ia" id="ia" class="form-control">
                    <option value="Ollama" {% if request.form.ia == 'Ollama' %}selected{% endif %}>Ollama</option>
                    <option value="Mistral" {% if request.form.ia == 'Mistral' %}selected{% endif %}>Mistral</option>
                    <option value="Gemini" {% if request.form.ia == 'Gemini' %}selected{% endif %}>Gemini</option>
                    <option value="Claude" {% if request.form.ia == 'Claude' %}selected{% endif %}>Claude</option>
                    <option value="Deepseek" {% if request.form.ia == 'Deepseek' %}selected{% endif %}>Deepseek</option>
                    <option value="OpenAI" {% if request.form.ia == 'OpenAI' %}selected{% endif %}>OpenAI</option>
                </select>
            </div>
            <div class="form-group">
                <label for="prompt">Pregunta sobre atención al cliente:</label>
                <textarea name="prompt" id="prompt" class="form-control" placeholder="Ej: ¿Cuál es el protocolo para atender llamadas? ¿Qué productos tienen garantía extendida?" rows="3">{{ request.form.prompt or '' }}</textarea>
                <small class="form-text text-muted">
                    Ejemplos: protocolo de llamadas, garantías, devoluciones, manejo de reclamos
                </small>
            </div>

            <hr />
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Buscar en el Manual
            </button>
        </form>
    </div>
</div>

<!-- Mostrar respuesta si existe -->
{% if respuesta %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-robot"></i> Respuesta del Chatbot desde {{ia}} AI
                    {% if tiempo_transcurrido %}
                    <small class="float-right">Tiempo: {{ tiempo_transcurrido }} segundos</small>
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-light border">
                    <pre class="mb-0" style="white-space: pre-wrap; font-family: inherit; font-size: 1rem;">
{{ respuesta }}
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Mostrar mensaje si no hay respuesta (solo después de enviar formulario) -->
{% if request.method == 'POST' and not respuesta %}
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            No se recibió respuesta. Verifica tu conexión o intenta con otra pregunta.
        </div>
    </div>
</div>
{% endif %}
{% endblock %}